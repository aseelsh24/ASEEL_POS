# وثيقة متطلبات المنتج (PRD)
## نظام نقطة بيع وإدارة مخزون لمحل بقالة صغير (نسخة MVP)

---

## معلومات الوثيقة

| الحقل | القيمة |
|---|---|
| اسم المنتج | نظام نقاط البيع والمخزون - محل بقالة |
| النسخة | MVP (الإصدار الأدنى القابل للتطبيق) |
| الجمهور المستهدف | محلات البقالة الصغيرة والمتوسطة |
| حالة الوثيقة | ✅ نهائية ومتسقة (نطاق MVP على جهاز واحد) |
| تاريخ الإصدار | 2025 |
| أصحاب المصلحة | مالك المحل، الكاشير |

---

## 1. ملخص تنفيذي (Executive Summary)

### 1.1 المشكلة

الاعتماد على العمليات اليدوية في البيع والمخزون يؤدي إلى:

- أخطاء في الحسابات والأسعار.
- ضياع الوقت في عملية البيع والجرد.
- عدم وجود رؤية فورية عن حالة المخزون والربح.
- صعوبة تتبع المبيعات والمشتريات.

### 1.2 الحل

تطوير نظام محلي سريع وسهل الاستخدام يتضمن:

- نقطة بيع سريعة مع دعم الباركود والطباعة.
- إدارة مخزون تلقائية ترتبط مباشرة بالمبيعات والمشتريات.
- تقارير أساسية تعطي رؤية فورية عن الأداء.
- عمل بدون إنترنت مع نسخ احتياطي محلي.

### 1.3 القيمة المقترحة

- ✅ تقليل الأخطاء التشغيلية بشكل كبير عبر أتمتة البيع والمخزون.
- ✅ تسريع عملية البيع وتقليل زمن الفاتورة.
- ✅ تحسين دقة المخزون والتنبيه قبل النفاد.
- ✅ تقدير الربح اليومي بدقة أفضل مقارنة بالعمل اليدوي.

### 1.4 معايير نجاح المنتج (Success Metrics)

يُقاس نجاح الـ MVP بعد الإطلاق عبر مؤشرات واضحة:

- زمن إتمام فاتورة قياسية (8–12 صنف) **≤ 30 ثانية**.
- نجاح البحث/المسح وإضافة الصنف للسلة **≥ 99%** دون تعليق أو تأخير ملحوظ.
- انخفاض فروقات الجرد الشهرية بشكل ملموس مقارنة بالطريقة اليدوية.
- استقرار النظام: تعطل مؤثر **≤ مرة واحدة/شهر** على جهاز واحد.

---

## 2. نطاق المنتج (Product Scope)

### 2.1 داخل النطاق (In-Scope) ✅

| الوحدة | الوصف |
|---|---|
| نقطة البيع (POS) | شاشة بيع سريعة، دعم باركود، تعديل كميات، خصم، طرق دفع، طباعة. |
| إدارة الأصناف | إضافة/تعديل/حذف أصناف، تصنيفات، أسعار، تكلفة، مخزون، تنبيهات. |
| المشتريات | فواتير مشتريات من الموردين، تحديث المخزون تلقائياً. |
| المرتجعات | مرتجع مبيعات (إلزامي)، مرتجع مشتريات (اختياري في MVP). |
| التسويات | تسوية مخزون يدوية لتصحيح الفروقات. |
| التقارير | مبيعات اليوم، أفضل الأصناف، تنبيهات مخزون، ربح تقديري. |
| الأساسيات | عمل دون إنترنت، نسخ احتياطي، واجهة عربية RTL، أمان أساسي. |

### 2.2 خارج النطاق (Out-of-Scope) ❌

- نظام محاسبي كامل (قيود يومية، أرصدة، قوائم مالية).
- إدارة فروع متعددة أو مزامنة سحابية.
- متجر إلكتروني أو موقع ويب.
- تكامل مع أنظمة دفع إلكترونية معقدة (بطاقات، محافظ).
- إدارة رواتب الموظفين.
- إدارة علاقات عملاء (CRM) متقدمة.
- جرد دوري آلي (يظل يدوياً في MVP).

---

## 3. المستخدمون والأدوار (User Personas & Roles)

### 3.1 مالك/مدير المحل

- **الهدف:** مراقبة الأداء، تحسين الأرباح، إدارة المخزون.
- **المهام:**
  - عرض التقارير والتحليلات.
  - إدارة الأسعار والتكاليف.
  - مراجعة وتعديل المخزون.
  - إدارة فواتير المشتريات.
  - مراجعة سجل الحركات والأخطاء.
- **الصلاحيات:** كاملة على جميع الوحدات.

### 3.2 كاشير/موظف بيع

- **الهدف:** إتمام عملية البيع بسرعة ودقة.
- **المهام:**
  - تنفيذ عمليات البيع والطباعة.
  - البحث عن الأصناف بالباركود أو الاسم.
  - التعامل مع المرتجعات البسيطة.
  - إعلام المدير بنفاد الأصناف.
- **الصلاحيات:**
  - البيع والطباعة فقط.
  - لا يمكنه تعديل التكلفة أو حذف فواتير.
  - لا يصل إلى تقارير الربح أو الإعدادات المتقدمة.

> **ملاحظة MVP:** يمكن البدء بدور واحد (المدير) لتسريع التطوير، ثم إضافة صلاحيات متدرجة.

---

## 4. المتطلبات الوظيفية التفصيلية

### 4.1 وحدة إدارة الأصناف

| الرقم | المتطلب | الوصف | الأولوية |
|---|---|---|---|
| FR-01 | إضافة صنف | إدخال بيانات صنف جديد (اسم، سعر، تكلفة، حد تنبيه). | عالية |
| FR-02 | تعديل صنف | تحديث بيانات صنف موجود. | عالية |
| FR-03 | حذف صنف | تفعيل حالة "غير نشط" بدلاً من الحذف الفعلي. | متوسطة |
| FR-04 | دعم الباركود | إدخال ومسح باركود للصنف. | عالية |
| FR-05 | التصنيفات | تقسيم الأصناف لفئات (مشروبات، مواد غذائية، الخ). | متوسطة |
| FR-06 | تنبيه النفاد | إظهار تحذير عندما يصل المخزون للحد الأدنى. | عالية |

**حقول بيانات الصنف:**

```sql
ProductID      (رقم فريد، تلقائي)
Name           (النص، مطلوب)
Barcode        (نص، اختياري، فريد)
Category       (نص، اختياري)
Unit           (نص، اختياري - مثال: قطعة/علبة/كرتون)
SalePrice      (رقم، مطلوب، >0)
CostPrice      (رقم، اختياري، >=0)
StockQty       (رقم، افتراضي 0)
MinStockAlert  (رقم، افتراضي 5)
ImageUrl       (نص، اختياري)
MaxDiscount    (رقم، اختياري - حد أعلى للخصم لاحقاً)
IsActive       (منطقي، افتراضي true)
CreatedAt      (تاريخ/وقت)
UpdatedAt      (تاريخ/وقت)
```

> **ملاحظة:** دعم الأصناف المباعة بالوزن يمكن إضافته لاحقاً في إصدار 1.2 ضمن "وحدات القياس المختلفة".

---

### 4.2 وحدة نقطة البيع (POS)

| الرقم | المتطلب | الوصف | الأولوية |
|---|---|---|---|
| FR-07 | بيع سريع | شاشة مركزية للبيع مع سلة مشتريات. | عالية |
| FR-08 | إضافة للسلة | عبر: 1- مسح باركود، 2- بحث بالاسم، 3- قائمة سريعة. | عالية |
| FR-09 | تعديل الكمية | زيادة/تقليل كمية الصنف في السلة. | عالية |
| FR-10 | تطبيق خصم | خصم على صنف فردي أو على الفاتورة كاملة. | متوسطة |
| FR-11 | طرق الدفع | نقدي (إجباري)، آجل (اختياري في MVP). | عالية |
| FR-12 | حفظ الفاتورة | توليد رقم فاتورة تسلسلي وحفظ البيانات. | عالية |
| FR-13 | طباعة الفاتورة | إرسال الفاتورة للطابعة الحرارية. | عالية |
| FR-14 | التحكم بالمخزون | منع بيع كمية أكبر من المتوفر (مع تجاوز بإذن). | عالية |

**حقول بيانات الفاتورة:**

```sql
InvoiceID           (رقم تسلسلي، فريد)
DateTime            (تاريخ/وقت البيع)
Cashier             (اسم المستخدم الذي أجرى البيع)
Items               (مصفوفة: ProductID, Qty, UnitPrice, Discount)
SubTotal            (المجموع قبل الخصم)
TotalDiscount       (إجمالي الخصم)
GrandTotal          (الصافي بعد الخصم)
RoundingAdjustment  (رقم، اختياري - فرق التقريب إن وجد)
PaymentMethod       (نقدي/آجل)
PaymentStatus       (مدفوع/غير مدفوع - للآجل)
CustomerName        (نص، اختياري - للآجل أو التوثيق)
Notes               (نص، اختياري)
IsCancelled         (منطقي، افتراضي false)
CancelledBy         (اسم المستخدم الذي ألغى)
CancelledAt         (تاريخ/وقت الإلغاء)
DeviceId            (نص، اختياري - مفيد للتوسع لاحقاً)
```

**قواعد العمل (Business Rules):**

1. عند حفظ البيع → `StockQty = StockQty - QtySold` تلقائياً.
2. إذا `QtySold > StockQty` → عرض تحذير **"الكمية غير متوفرة"**.
3. خيار **"تجاوز بإذن المدير"** يتطلب إدخال كلمة مرور المدير.
4. الفواتير الملغاة لا تحذف بل تُعلم وتظهر في التقارير.

---

### 4.3 وحدة المشتريات

| الرقم | المتطلب | الوصف | الأولوية |
|---|---|---|---|
| FR-15 | فاتورة مشتريات | إنشاء فاتورة شراء من مورد. | عالية |
| FR-16 | تحديث المخزون | زيادة المخزون تلقائياً بعد حفظ الفاتورة. | عالية |
| FR-17 | إدخال التكلفة | إدخال سعر الشراء للصنف (يُخزن مع الحركة). | عالية |
| FR-18 | اسم المورد | إدخال اسم المورد (نص حر في MVP). | متوسطة |

**حقول بيانات المشتريات:**

```sql
PurchaseID     (رقم تسلسلي)
SupplierName   (نص، مطلوب)
DateTime       (تاريخ/وقت الشراء)
Items          (مصفوفة: ProductID, Qty, CostPrice)
TotalCost      (إجمالي التكلفة)
ReceivedBy     (اسم المستخدم)
```

---

### 4.4 وحدة المرتجعات والتسويات

| الرقم | المتطلب | الوصف | الأولوية |
|---|---|---|---|
| FR-19 | مرتجع مبيعات | إرجاع أصناف من فاتورة بيع سابقة. | عالية |
| FR-20 | إعادة للمخزون | زيادة المخزون تلقائياً عند الإرجاع. | عالية |
| FR-21 | تسوية المخزون | تصحيح الفرق بين المخزون الظاهري والفعلي. | عالية |
| FR-22 | سبب التسوية | تسجيل سبب التعديل (هدر، تلف، خطأ). | متوسطة |

**قواعد مرتجع المبيعات:**

1. المرتجع مرتبط بفاتورة أصلية.
2. يدعم الإرجاع الجزئي.
3. لا يمكن إرجاع كمية أكبر من المباعة في الفاتورة الأصلية.
4. تسجيل **سبب الإرجاع** كسطر ملاحظة إلزامي في المرتجع.

---

### 4.5 سجل حركة المخزون (Stock Ledger)

**مبدأ العمل:** تسجيل كل تغيير في المخزون كحركة قابلة للتدقيق.

**أنواع الحركات:**

- `PURCHASE`: زيادة من شراء.
- `SALE`: نقص من بيع.
- `SALES_RETURN`: زيادة من مرتجع بيع.
- `ADJUSTMENT`: تعديل يدوي (زيادة أو نقص).
- `OPENING_BALANCE`: رصيد افتتاحي.

**حقول سجل الحركة:**

```sql
MovementID     (رقم فريد)
DateTime       (تاريخ/وقت الحركة)
Type           (نوع الحركة)
ProductID      (رقم الصنف)
QtyChange      (رقم، موجب للزيادة، سالب للنقصان)
NewBalance     (الرصيد الجديد بعد الحركة)
ReferenceID    (رقم الفاتورة المرتبطة)
User           (المستخدم المسؤول)
Notes          (سبب التعديل إن وجد)
```

---

### 4.6 وحدة التقارير

| الرقم | التقرير | الوصف | الأولوية |
|---|---|---|---|
| FR-23 | مبيعات اليوم | إجمالي المبيعات، عدد الفواتير، متوسط الفاتورة. | عالية |
| FR-24 | أفضل 10 أصناف | الأكثر مبيعاً من حيث الكمية والقيمة. | عالية |
| FR-25 | تنبيهات المخزون | قائمة بالأصناف التي وصلت للحد الأدنى. | عالية |
| FR-26 | ربح تقديري | (سعر البيع - تكلفة الشراء) × الكمية المباعة. | عالية |
| FR-27 | حركة صنف | تاريخ حركات صنف معين (دخول، خروج، رصيد). | متوسطة |

**سياسة احتساب التكلفة والربح في MVP:**

- تعتمد التكلفة على **آخر سعر شراء مسجل** للصنف (*Last Purchase Cost*).

**معادلة الربح التقديري:**

```text
الربح = Σ لكل صنف مباع [(سعر البيع - تكلفة الشراء) × الكمية المباعة]
```

> **خيار مستقبلي:** دعم **متوسط التكلفة المرجّح** (*Weighted Average Cost*) ضمن إصدار لاحق لتحسين الدقة المحاسبية.

---

## 5. المتطلبات غير الوظيفية

| الفئة | المتطلب | المعيار المقبول |
|---|---|---|
| الأداء | سرعة الإضافة للسلة | < 1 ثانية حتى مع 3000 صنف. |
| الأداء | سرعة البحث | نتائج فورية عند الكتابة (Debounced). |
| الاعتمادية | العمل دون إنترنت | 100% من الوظائف تعمل دون اتصال. |
| الاعتمادية | حفظ البيانات | حفظ آلي كل 30 ثانية + عند الإغلاق. |
| سهولة الاستخدام | الواجهة | عربية RTL، أزرار كبيرة (min 48px). |
| سهولة الاستخدام | الاختصارات | دعم لوحة المفاتيح (مسافة لإضافة، Enter لحفظ). |
| سهولة الاستخدام | التعلم | لا يحتاج تدريب أكثر من 30 دقيقة. |
| الأمان | تسجيل الدخول | مستخدم/كلمة مرور أساسية. |
| الأمان | قفل تلقائي | قفل الشاشة بعد فترة خمول قابلة للضبط (افتراضي 5 دقائق). |
| الأمان | سجل التدقيق | تسجيل عمليات: تعديل أسعار/تكلفة، تسوية مخزون، إلغاء فاتورة. |
| الصيانة | النسخ الاحتياطي | نسخ تلقائي يومي + نسخ يدوي عند الطلب. |
| الصيانة | سياسة الاحتفاظ | الاحتفاظ بآخر 7 نسخ احتياطية تلقائية. |
| الصيانة | التصدير | تصدير البيانات إلى CSV/Excel. |

---

## 6. واجهات النظام (Interfaces)

### 6.1 واجهات المستخدم الرئيسية

1. شاشة تسجيل الدخول (بسيطة - مستخدم/كلمة مرور).
2. لوحة التحكم الرئيسية (Dashboard) مع:
   - اختصارات سريعة للوحدات.
   - إشعارات تنبيه المخزون.
   - إحصائيات اليوم (المبيعات، الفواتير).
3. شاشة البيع (POS) - الواجهة الأكثر استخداماً:
   - منطقة البحث/المسح.
   - سلة المشتريات (قائمة قابلة للتعديل).
   - لوحة الأرقام للحساب.
   - ملخص الفاتورة (المجموع، الخصم، الصافي).
   - أزرار الدفع والطباعة.
4. شاشة إدارة الأصناف (جدول + زر إضافة).
5. شاشة التقارير (تبويبات لكل تقرير).

### 6.2 واجهات الأجهزة

- الطابعة الحرارية: دعم الطباعة المباشرة عبر بروتوكول ESC/POS.
- قارئ الباركود: دعم الإدخال التلقائي كـ **keyboard wedge**.
- الشاشة اللمسية: تحسين التصميم للأجهزة اللوحية (Tablet).

---

## 7. سيناريوهات الاستخدام الرئيسية (Key User Flows)

### 7.1 بيع سريع (الكاشير)

1. تسجيل الدخول (إن وجدت صلاحيات).
2. الانتقال لشاشة البيع الرئيسية.
3. مسح باركود الصنف (أو البحث بالاسم).
4. إدخال الكمية (افتراضي 1).
5. تكرار الخطوات 3-4 لإضافة جميع الأصناف.
6. تطبيق خصم إذا لزم (على الصنف أو الفاتورة).
7. اختيار طريقة الدفع (نقدي).
8. الضغط على "إتمام البيع".
9. تأكيد الطباعة (إن وجدت طابعة).
10. النظام يخصم الكميات تلقائياً من المخزون.

### 7.2 إضافة توريد جديد (المدير)

1. الدخول لقائمة "المشتريات".
2. الضغط على "فاتورة شراء جديدة".
3. إدخال اسم المورد.
4. إضافة الأصناف (بحث أو باركود).
5. إدخال كميات وأسعار الشراء.
6. مراجعة المجموع.
7. الضغط على "حفظ الفاتورة".
8. النظام يزيد المخزون تلقائياً، ويسجل حركة شراء.

### 7.3 مراجعة تقرير اليوم (المدير)

1. الدخول للوحة التحكم (بعد تسجيل الدخول).
2. مشاهدة إحصائيات اليوم مباشرة.
3. الضغط على "التقارير" للتفاصيل.
4. اختيار "مبيعات اليوم".
5. تصدير البيانات لـ Excel إذا رغب.
6. مراجعة قائمة "تنبيهات المخزون".
7. اتخاذ قرار بإعادة الطلب للأصناف المنخفضة.

---

## 8. معايير القبول (Acceptance Criteria)

يُعتبر MVP ناجحاً وجاهزاً للإطلاق عندما:

1. ✅ البيع الأساسي: يمكن إتمام عملية بيع كاملة في أقل من 30 ثانية لسيناريو فاتورة قياسية.
2. ✅ تحديث المخزون: عند البيع → ينقص المخزون تلقائياً وعرضياً للمستخدم.
3. ✅ المشتريات: يمكن إدخال فاتورة شراء وزيادة المخزون تلقائياً.
4. ✅ المرتجعات: يمكن تنفيذ مرتجع مبيعات مرتبط بفاتورة مع استعادة المخزون.
5. ✅ التقارير الأساسية: تظهر تقارير اليوم وتنبيهات المخزون بشكل صحيح.
6. ✅ النسخ الاحتياطي: النسخ التلقائي واليدوي يعملان مع سياسة احتفاظ واضحة.
7. ✅ الواجهة العربية: جميع العناصر بالعربية ومتوافقة مع RTL.
8. ✅ العمل دون إنترنت: جميع الميزات تعمل بدون اتصال إنترنت.
9. ✅ الطابعة: دعم الطباعة الحرارية (إن وجدت المعدات).

---

## 9. القيود والافتراضات

### 9.1 القيود التقنية

- يعمل على جهاز واحد فقط (لا تزامن متعدد أجهزة).
- قاعدة بيانات محلية (SQLite/IndexedDB).
- لا يدعم التحديث التلقائي عبر الهواء (يحتاج تنزيل يدوي).
- الطابعة يجب أن تكون متصلة مباشرة أو عبر شبكة محلية.

### 9.2 افتراضات العمل

- المستخدم لديه معرفة أساسية بالبيع والمخزون.
- الإدخال الأولي للأصناف سيكون يدوياً (قد يستغرق وقتاً).
- تكلفة الشراء قد لا تُدخل لجميع الأصناف في البداية (سيؤثر على دقة الربح).
- النظام مصمم لمتجر واحد لا يتعدى 5000 صنف.

### 9.3 التبعيات (Dependencies)

- جهاز كمبيوتر/تابلت يعمل بنظام Windows/macOS/Android.
- متصفح حديث (Chrome 90+, Firefox 88+).
- طابعة حرارية 80mm (موصى بها لكن غير إلزامية).
- قارئ باركود (مُساعد لكن غير إلزامي).

---

## 10. معايير العملة والتقريب

- **العملة الافتراضية:** يتم ضبطها من الإعدادات عند أول تشغيل (افتراضي: العملة المحلية).
- **التقريب المالي:** دعم تحديد قاعدة التقريب (افتراضي: التقريب لأقرب رقم صحيح حسب إعدادات العملة).
- **فروق التقريب:** تُسجل في الفاتورة ضمن `RoundingAdjustment` عند الحاجة.

---

## 11. خارطة الطريق المقترحة (Roadmap)

### الإصدار MVP (1.0)

- جميع المتطلبات الواردة في هذه الوثيقة.

### الإصدار 1.1 (تحسينات سريعة)

- إدارة الموردين (جهات اتصال، سجل مشتريات).
- ديون العملاء (بيع آجل مع متابعة).
- عروض وتخفيضات مسبقة (Buy 1 Get 1).

### الإصدار 1.2 (إدارة متقدمة)

- مستخدمون متعددون مع صلاحيات مفصلة.
- تقارير شهرية ومقارنات.
- دعم وحدات القياس المختلفة (جرام، لتر) والأصناف المباعة بالوزن.
- خيار احتساب تكلفة المخزون بطريقة **متوسط التكلفة المرجّح**.

### الإصدار 2.0 (توسع)

- مزامنة سحابية (نسخة احتياطية على السحابة).
- دعم فروع متعددة.
- تطبيق جوال للمدير للمتابعة عن بُعد.

---

## 12. الملاحق

### 12.1 اقتراح تقني مبسط

- **Frontend:** React + TypeScript + Vite (كم PWA).
- **الحالة المحلية:** Zustand/Redux Toolkit.
- **قاعدة البيانات:** SQLite (باستخدام Tauri أو Electron) أو IndexedDB.
- **الطباعة:** مكتبة escpos للتوصيل بالطابعة الحرارية.
- **النسخ الاحتياطي:** تصدير قاعدة البيانات إلى ملف بتاريخ واضح بصيغة:
  - `backup_YYYY-MM-DD_HH-mm.db` أو ما يعادلها.
- **التصميم:** مكتبة عربية مثل Mantine أو Ant Design مع تعديلات RTL.

### 12.2 مسرد المصطلحات

- **POS:** Point of Sale - نقطة البيع.
- **MVP:** Minimum Viable Product - المنتج الأدنى القابل للتطبيق.
- **SKU:** Stock Keeping Unit - وحدة حفظ المخزون (مرادف للصنف).
- **باركود:** رمز شريطي يمثل رقم تعريف للصنف.
- **رصيد افتتاحي:** كمية الصنف الموجودة فعلياً عند بدء استخدام النظام.

---

## 13. تاريخ المراجعات

| الإصدار | التاريخ | الوصف | المعتمد من |
|---|---|---|---|
| 1.0 | 2024 | الإصدار الأولي الكامل | فريق الإدارة |
| 1.1 | 2025 | تحسينات توضيحية لنطاق الـ MVP والسياسات التشغيلية | فريق الإدارة |

---

✅ هذه النسخة محسّنة لتقليل اللبس أثناء التطوير والاختبار مع الحفاظ على روح الـ MVP.
