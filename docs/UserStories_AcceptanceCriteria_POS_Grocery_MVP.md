# User Stories + Acceptance Criteria — نظام نقطة بيع وإدارة مخزون (MVP)

يحتوي هذا الملف على قصص المستخدم ومعايير القبول بطريقة مختصرة وعملية.

---

## EPIC 0 — الأساسيات والبنية (Foundation)

### US-0.1 تهيئة المشروع
**كـمطور** أريد إعداد مشروع React + TypeScript + Vite مع دعم RTL  
**لكي** يكون التطبيق جاهزاً لواجهات عربية.

**قبول:**
- تشغيل محلي بدون أخطاء.
- RTL مفعل على مستوى التطبيق.
- إعداد Routing للصفحات الأساسية.

### US-0.2 إعداد التخزين المحلي
**كـمطور** أريد تنفيذ طبقة تخزين محلي  
**لكي** يعمل النظام دون إنترنت.

**قبول:**
- CRUD للمنتجات والفواتير وحركات المخزون.
- آلية Versioning بسيطة للبيانات.

### US-0.3 إعداد أول تشغيل
**كـمدير** أريد شاشة إعداد أولي  
**لكي** أحدد العملة واسم المتجر وقاعدة التقريب.

**قبول:**
- حفظ الإعدادات محلياً.
- لا يسمح بتجاوز الإعداد دون إدخال الحد الأدنى.

---

## EPIC 1 — المستخدمون والدخول (Auth Lite)

### US-1.1 تسجيل دخول بسيط
**كـمدير** أريد تسجيل دخول محلي  
**لكي** أحمي النظام من الاستخدام غير المصرح.

**قبول:**
- نموذج دخول محلي يعمل offline.
- جلسة مستخدم محفوظة حتى تسجيل الخروج.

### US-1.2 قفل تلقائي
**كـمدير** أريد قفل تلقائي بعد فترة خمول  
**لكي** أحافظ على خصوصية النظام في بيئة المحل.

**قبول:**
- افتراضي 5 دقائق.
- قابل للتعديل من الإعدادات.

---

## EPIC 2 — إدارة الأصناف والتصنيفات (Catalog)

### US-2.1 إضافة صنف
**كـمدير** أريد إضافة صنف  
**لكي** أبني قاعدة المنتجات.

**قبول:**
- حقول إلزامية: Name, SalePrice.
- Barcode اختياري وفريد إن أدخل.
- MinStockAlert افتراضي 5.
- StockQty افتراضي 0.

### US-2.2 تعديل صنف
**كـمدير** أريد تعديل بيانات صنف  
**لكي** أحدث الأسعار والتكلفة والحد الأدنى.

**قبول:**
- تعديل SalePrice وCostPrice وMinStockAlert.
- تحديث UpdatedAt.

### US-2.3 تعطيل صنف
**كـمدير** أريد تعطيل صنف بدل حذفه  
**لكي** أحافظ على تاريخ الفواتير.

**قبول:**
- IsActive = false.
- الصنف لا يظهر في شاشة البيع افتراضياً.

### US-2.4 التصنيفات
**كـمدير** أريد إدارة التصنيفات  
**لكي** أسهّل البحث والتنظيم.

**قبول:**
- إنشاء/تعديل/حذف تصنيف.
- ربط صنف بتصنيف اختياري.

### US-2.5 استيراد/تصدير CSV
**كـمدير** أريد استيراد/تصدير أصناف  
**لكي** أسرع الإدخال الأولي.

**قبول:**
- تصدير CSV UTF-8.
- منع إدخال باركود مكرر أثناء الاستيراد.

---

## EPIC 3 — شاشة نقطة البيع (POS Core)

### US-3.1 واجهة بيع سريعة
**كـكاشير/مدير** أريد شاشة بيع واضحة  
**لكي** أتم الفواتير بسرعة.

**قبول:**
- سلة تعرض: الاسم/السعر/الكمية/الإجمالي.
- تعديل كمية سريع عبر +/-.

### US-3.2 إضافة بالباركود
**كـمستخدم** أريد إضافة صنف عبر مسح الباركود  
**لكي** أسرّع البيع.

**قبول:**
- قراءة إدخال قارئ الباركود كـ keyboard wedge.
- تنبيه واضح عند عدم العثور على الصنف.

### US-3.3 البحث بالاسم
**كـمستخدم** أريد بحثاً فورياً  
**لكي** أجد الصنف بسرعة بدون باركود.

**قبول:**
- بحث سريع مع Debounce.
- دعم العربية.

### US-3.4 التحكم بالمخزون أثناء البيع
**كـمدير** أريد منع بيع كمية أكبر من المتوفر  
**لكي** لا يحدث بيع وهمي.

**قبول:**
- تحذير عند تجاوز المتاح.
- خيار تجاوز يتطلب كلمة مرور المدير.

### US-3.5 الخصومات
**كـمستخدم** أريد تطبيق خصم  
**لكي** أنفذ عروضاً بسيطة.

**قبول:**
- خصم على صنف أو على الفاتورة.
- حساب صحيح للخصم في إجمالي الفاتورة.

### US-3.6 الدفع النقدي
**كـمستخدم** أريد إتمام الدفع النقدي  
**لكي** أحفظ البيع بشكل نهائي.

**قبول:**
- توليد InvoiceID تسلسلي.
- حفظ الفاتورة محلياً.
- خصم StockQty تلقائياً.
- إضافة حركة SALE في السجل.

### US-3.7 البيع الآجل (اختياري)
**كـمدير** أريد خيار بيع آجل  
**لكي** أستخدمه عند الحاجة.

**قبول:**
- PaymentMethod = Credit.
- PaymentStatus = Unpaid.
- CustomerName اختياري.

---

## EPIC 4 — المشتريات (Purchases)

### US-4.1 فاتورة مشتريات
**كـمدير** أريد إنشاء فاتورة شراء  
**لكي** أدخل التوريد بسهولة.

**قبول:**
- إدخال SupplierName.
- إضافة أصناف مع Qty وCostPrice.
- TotalCost يُحسب تلقائياً.

### US-4.2 تحديث المخزون
**كـمدير** أريد زيادة المخزون تلقائياً بعد الشراء  
**لكي** أتجنب التعديل اليدوي.

**قبول:**
- StockQty يزيد وفق الكميات المستلمة.
- حركة PURCHASE تُسجل.

### US-4.3 مورد نص حر
**كـمدير** أريد إدخال اسم المورد كنص  
**لكي** لا نُعقد إدارة الموردين في MVP.

**قبول:**
- SupplierName مطلوب.

---

## EPIC 5 — المرتجعات والتسويات

### US-5.1 مرتجع مبيعات
**كـمدير/كاشير** أريد إرجاع أصناف من فاتورة سابقة  
**لكي** أعالج الإرجاعات والأخطاء.

**قبول:**
- اختيار فاتورة أصلية.
- دعم الإرجاع الجزئي.
- منع إرجاع كمية أكبر من المباعة.
- سبب الإرجاع إلزامي.

### US-5.2 إعادة للمخزون
**كـمدير** أريد استعادة المخزون عند الإرجاع  
**لكي** يبقى المخزون صحيحاً.

**قبول:**
- StockQty يزيد تلقائياً.
- حركة SALES_RETURN تُسجل.

### US-5.3 تسوية مخزون
**كـمدير** أريد تعديل مخزون يدوي مع سبب  
**لكي** أعالج التلف/الهدر.

**قبول:**
- اختيار سبب إلزامي.
- حركة ADJUSTMENT مع QtyChange صحيح.

---

## EPIC 6 — سجل حركة المخزون (Ledger)

### US-6.1 سجل حركة تلقائي
**كـمدير** أريد سجل حركة لكل تغيير  
**لكي** أتتبع مصدر الفروقات.

**قبول:**
- تسجيل SALE/PURCHASE/SALES_RETURN/ADJUSTMENT/OPENING.
- NewBalance صحيح بعد كل حركة.

### US-6.2 عرض حركة صنف
**كـمدير** أريد شاشة تاريخ حركة صنف  
**لكي** أراجع دخوله وخروجه.

**قبول:**
- فلترة حسب التاريخ ونوع الحركة.

---

## EPIC 7 — التقارير

### US-7.1 مبيعات اليوم
**كـمدير** أريد تقرير مبيعات اليوم  
**لكي** أعرف الأداء اليومي.

**قبول:**
- إجمالي المبيعات.
- عدد الفواتير.
- متوسط قيمة الفاتورة.

### US-7.2 أفضل 10 أصناف
**كـمدير** أريد قائمة أفضل الأصناف  
**لكي** أعرف الأكثر حركة وربحاً.

**قبول:**
- ترتيب حسب الكمية والقيمة.

### US-7.3 تنبيهات الحد الأدنى
**كـمدير** أريد تنبيهات مخزون  
**لكي** أعيد الطلب قبل النفاد.

**قبول:**
- قائمة محدثة تلقائياً للأصناف تحت MinStockAlert.

### US-7.4 ربح تقديري
**كـمدير** أريد ربحاً تقديرياً  
**لكي** أفهم الاتجاه العام للأرباح.

**قبول:**
- يعتمد على Last Purchase Cost.
- يظهر تنبيه أنه تقديري.

---

## EPIC 8 — النسخ الاحتياطي والتصدير

### US-8.1 نسخ احتياطي يدوي
**كـمدير** أريد حفظ نسخة احتياطية يدوياً  
**لكي** أنقلها أو أحفظها خارج الجهاز.

**قبول:**
- توليد ملف Backup قابل للتنزيل/الحفظ.

### US-8.2 نسخ احتياطي تلقائي
**كـمدير** أريد نسخاً تلقائياً يومياً  
**لكي** لا أفقد البيانات.

**قبول:**
- حفظ نسخة يومية.
- الاحتفاظ بآخر 7 نسخ تلقائية.

### US-8.3 تصدير CSV
**كـمدير** أريد تصدير تقارير إلى CSV  
**لكي** أفتحها في Excel.

**قبول:**
- CSV UTF-8 للمنتجات والمبيعات وتنبيهات المخزون.

---

## EPIC 9 — الطباعة والأجهزة

### US-9.1 إعداد طابعة
**كـمدير** أريد إعداد طابعة ESC/POS  
**لكي** أطبع فواتير رسمية.

**قبول:**
- شاشة إعداد للطابعة.
- زر اختبار طباعة.

### US-9.2 طباعة بعد البيع
**كـمستخدم** أريد طباعة تلقائية بعد إتمام البيع  
**لكي** لا أنفذ خطوة إضافية.

**قبول:**
- خيار تشغيل/إيقاف الطباعة التلقائية.
- قالب فاتورة بسيط وواضح.

---
