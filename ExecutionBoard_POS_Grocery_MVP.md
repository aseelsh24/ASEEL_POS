# لوح تنفيذ مقترح — نظام نقطة بيع وإدارة مخزون (MVP)

هذا اللوح يحول الـ Epics و الـ User Stories إلى **مهام تقنية عملية** مع تقدير حجم مبسط.
التقديرات هنا **إرشادية** لمشروع MVP على جهاز واحد وبدون مزامنة سحابية.

---

## مقياس التقدير

- **S (Small):** 0.5–1 يوم عمل
- **M (Medium):** 1–3 أيام
- **L (Large):** 3–5 أيام
- **XL (Extra Large):** يحتاج تفكيك قبل التنفيذ

> ملاحظة: التقدير يفترض مطور واحد Full-stack Frontend-heavy مع خبرة PWA/Local DB.

---

## EPIC 0 — الأساسيات والبنية (Foundation)

### US-0.1 تهيئة المشروع — **S**
**مهام تقنية:**
- إنشاء مشروع Vite React TS.
- إعداد ESLint/Prettier.
- إعداد Router (صفحات: Login, Dashboard, POS, Products, Purchases, Reports, Settings).
- تفعيل RTL + خط عربي مناسب.
- إعداد بنية مجلدات أولية.

### US-0.2 إعداد التخزين المحلي — **L**
**مهام تقنية:**
- اختيار النهج:
  - IndexedDB (Dexie) للويب الصرف، أو
  - SQLite عبر Tauri/Electron (إذا كان Desktop).
- تصميم طبقة Repository موحدة:
  - ProductsRepo
  - InvoicesRepo
  - PurchasesRepo
  - MovementsRepo
  - SettingsRepo
- بناء CRUD أساسي لكل كيان.
- إضافة Versioning/Migrations بسيطة.
- اختبارات CRUD الأساسية.

### US-0.3 إعداد أول تشغيل — **S**
**مهام تقنية:**
- صفحة Wizard لأول تشغيل.
- تخزين إعدادات: اسم المتجر، العملة، قاعدة التقريب.
- حماية المسارات حتى اكتمال الإعداد.

---

## EPIC 1 — المستخدمون والدخول (Auth Lite)

### US-1.1 تسجيل دخول بسيط — **S**
**مهام تقنية:**
- نموذج Login.
- تخزين مستخدم محلي واحد (المدير).
- Session بسيطة (LocalStorage/DB).
- زر Logout.

### US-1.2 قفل تلقائي — **S**
**مهام تقنية:**
- Idle timer.
- شاشة Lock.
- إعداد مدة الخمول في Settings.

---

## EPIC 2 — إدارة الأصناف والتصنيفات (Catalog)

### US-2.1 إضافة صنف — **M**
**مهام تقنية:**
- نموذج إضافة صنف.
- تحقق إدخال:
  - Name مطلوب.
  - SalePrice > 0.
  - Barcode فريد إن وجد.
- حقول اختيارية: Unit, ImageUrl, CostPrice.
- حفظ في DB.

### US-2.2 تعديل صنف — **M**
**مهام تقنية:**
- شاشة تفاصيل/تعديل.
- تحديث UpdatedAt.
- منع تعارض الباركود.

### US-2.3 تعطيل صنف — **S**
**مهام تقنية:**
- زر تعطيل/تفعيل.
- فلترة الأصناف غير النشطة في POS افتراضياً.

### US-2.4 التصنيفات — **M**
**مهام تقنية:**
- جدول تصنيفات بسيط.
- ربط Category بالمنتج.
- فلترة/بحث حسب التصنيف.

### US-2.5 استيراد/تصدير CSV — **M**
**مهام تقنية:**
- تصدير CSV UTF-8.
- استيراد CSV مع:
  - Preview.
  - فحص الباركود المكرر.
  - تقرير أخطاء صفية.

---

## EPIC 3 — شاشة نقطة البيع (POS Core)

### US-3.1 واجهة بيع سريعة — **M**
**مهام تقنية:**
- بناء شاشة POS Layout:
  - Input_barcode/search
  - Cart table
  - Summary box
  - Keypad (اختياري UI)
- إدارة حالة السلة محلياً (Zustand).
- اختصارات لوحة مفاتيح.

### US-3.2 إضافة بالباركود — **M**
**مهام تقنية:**
- Listener لإدخال قارئ الباركود.
- بحث سريع في المنتجات حسب Barcode.
- إضافة تلقائية للسلة.

### US-3.3 البحث بالاسم — **M**
**مهام تقنية:**
- Search input مع Debounce.
- قائمة نتائج سريعة.
- دعم العربية والبحث الجزئي.

### US-3.4 التحكم بالمخزون أثناء البيع — **M**
**مهام تقنية:**
- تحقق StockQty عند تعديل الكمية.
- نافذة Override بإدخال كلمة مرور المدير.
- تسجيل override flag داخل الفاتورة (اختياري).

### US-3.5 الخصومات — **M**
**مهام تقنية:**
- خصم صنف/فاتورة (نسبة أو مبلغ).
- تحديث الحسابات فورياً.
- منع خصم سلبي/مبالغ فيه.

### US-3.6 الدفع النقدي وحفظ الفاتورة — **L**
**مهام تقنية:**
- Generator لرقم InvoiceID تسلسلي.
- بناء نموذج بيانات الفاتورة.
- حفظ الفاتورة.
- خصم المخزون.
- إنشاء حركات SALE لكل سطر.
- معالجة التقريب وإضافة RoundingAdjustment إن لزم.
- دعم إلغاء فاتورة (Mark cancelled) إن رغبت ضمن POS.

### US-3.7 البيع الآجل — **S/M**
**مهام تقنية:**
- PaymentMethod = Credit.
- PaymentStatus = Unpaid.
- CustomerName اختياري.
> إذا أجلته للإصدار 1.1 يصبح خارج خط الـ MVP الأساسي.

---

## EPIC 4 — المشتريات (Purchases)

### US-4.1 إنشاء فاتورة مشتريات — **M**
**مهام تقنية:**
- شاشة Purchases + نموذج جديد.
- إضافة أصناف وكميات وتكلفة.
- حساب TotalCost.

### US-4.2 تحديث المخزون من المشتريات — **M**
**مهام تقنية:**
- زيادة StockQty بعد الحفظ.
- تسجيل حركات PURCHASE.
- تحديث CostPrice (آخر تكلفة شراء) للمنتج.

### US-4.3 مورد نص حر — **S**
**مهام تقنية:**
- حقل SupplierName مطلوب.

---

## EPIC 5 — المرتجعات والتسويات

### US-5.1 مرتجع مبيعات — **L**
**مهام تقنية:**
- واجهة اختيار فاتورة أصلية.
- عرض عناصر الفاتورة.
- إدخال كميات مرتجعة.
- تحقق: لا يتجاوز المبيع.
- حفظ سند مرتجع (نوع وثيقة منفصل أو Invoice نوع Return).

### US-5.2 إعادة للمخزون — **M**
**مهام تقنية:**
- زيادة StockQty.
- تسجيل حركات SALES_RETURN.
- ربط ReferenceID بالفاتورة الأصلية.

### US-5.3 تسوية مخزون — **M**
**مهام تقنية:**
- شاشة Adjustment.
- إدخال QtyChange موجب/سالب.
- سبب إلزامي.
- تسجيل حركة ADJUSTMENT.

---

## EPIC 6 — سجل حركة المخزون (Ledger)

### US-6.1 سجل تلقائي — **M**
**مهام تقنية:**
- Service موحد لتسجيل الحركات.
- حساب NewBalance بعد كل حركة.
- منع اختلافات الرصيد الناتجة عن ترتيب عمليات غير متوقع.

### US-6.2 شاشة حركة صنف — **S/M**
**مهام تقنية:**
- صفحة Product Ledger.
- فلترة حسب التاريخ والنوع.
- تصدير CSV اختياري.

---

## EPIC 7 — التقارير الأساسية

### US-7.1 مبيعات اليوم — **M**
**مهام تقنية:**
- Query فواتير اليوم.
- حساب:
  - إجمالي المبيعات.
  - عدد الفواتير.
  - المتوسط.

### US-7.2 أفضل 10 أصناف — **M**
**مهام تقنية:**
- Aggregate حسب ProductID.
- مؤشرات كمية/قيمة.

### US-7.3 تنبيهات الحد الأدنى — **S**
**مهام تقنية:**
- Query منتجات StockQty <= MinStockAlert.
- عرض سريع في Dashboard.

### US-7.4 ربح تقديري — **M**
**مهام تقنية:**
- استخدام Last Purchase Cost لكل صنف.
- حساب الربح وفق المبيعات.
- تحذير UI أنه تقديري.

---

## EPIC 8 — النسخ الاحتياطي والتصدير

### US-8.1 نسخ يدوي — **M**
**مهام تقنية:**
- تصدير DB أو JSON حسب التقنية.
- زر Download/Save.
- تسمية ملف موحدة.

### US-8.2 نسخ تلقائي يومي — **M**
**مهام تقنية:**
- Scheduler بسيط داخل التطبيق.
- إدارة 7 نسخ فقط (rotation).
- سجل آخر وقت نسخ.

### US-8.3 تصدير CSV — **S/M**
**مهام تقنية:**
- Export utilities.
- دعم UTF-8.
- منتجات + مبيعات اليوم + تنبيهات مخزون.

---

## EPIC 9 — الطباعة والأجهزة

### US-9.1 إعداد طابعة ESC/POS — **L**
**مهام تقنية:**
- اختيار تقنية الطباعة:
  - WebUSB/WebSerial (إن سمح الجهاز).
  - أو Print bridge محلي.
- قالب فاتورة 80mm.
- زر اختبار طباعة.

### US-9.2 طباعة بعد البيع — **S**
**مهام تقنية:**
- Toggle للطباعة التلقائية.
- استدعاء خدمة الطباعة بعد حفظ الفاتورة.

---

## تقدير إجمالي سريع

- مجموع تقريبي بدون طباعة متقدمة: ** ~ 25–35 يوم عمل**
- مع طباعة ESC/POS على الويب بمرونة عالية: ** + 3–7 أيام**

> هذه الأرقام تتغير حسب اختيار قاعدة البيانات والتشغيل (Web-only vs Desktop).

